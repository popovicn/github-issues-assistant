version: '3.1'
intents:
- bot_challenge
- greet
- inform
- affirm
- deny
- cancel_op
- act_submit_issue
- op_check_issue
- nlu_fallback
actions:
- choose_action
- send_submit_issue_form
- ask_confirm_submit_issue
- reset_all_slots_except_username
- action_default_fallback
- action_deactive_loop
- action_check_issue
responses:
  utter_default:
    - text: Sorry, I didn't understand that.
  utter_iamabot:
    - text: I am a bot, powered by Rasa.
  utter_anything_else:
    - text: Can I do anything else for you?
  utter_cancel_submit_issue:
    - text: Ok, your request is cancelled.
  utter_please_rephrase:
    - text: I'm sorry, I didn't understand that. Could you rephrase?
  utter_submit_issue:
    - text: What is your GitHub username?
  utter_choose:
    - text: "Do you need to submit new issue or check existing?"
      buttons:
        - title: "Submit new issue"
          payload: /act_submit_issue
        - title: "Check existing issue"
          payload: /op_check_issue
  utter_act_submit_issue:
    - text: You choose to submit issue
  utter_ask_submit_issue_form_gh_username:
    - text: What is your GitHub username?
  utter_ask_submit_issue_form_issue_description:
    - text: Please describe your issue
  utter_ask_submit_issue_form_issue_label:
    - text: Please enter issue label
  utter_ask_submit_issue_form_version:
    - text: Which version of the product are you using?
  utter_ask_issue_id:
    - text: What is the number of issue you want to check?
entities:
- version
- gh_username
- issue_description
- issue_label
- issue_id

slots:
  slot_validate_form:
    type: bool
    mappings:
      - type: custom
  gh_username:
    type: text
    influence_conversation: true
    mappings:
      - entity: gh_username
        type: from_entity
        conditions:
          - active_loop: submit_issue_form
            requested_slot: gh_username
      - entity: gh_username
        type: from_entity
        intent: act_submit_issue
  issue_description:
    type: text
    influence_conversation: true
    mappings:
      - type: from_text
        not_intent: cancel_op
        conditions:
          - active_loop: submit_issue_form
            requested_slot: issue_description
  version:
    type: text
    influence_conversation: true
    mappings:
      - entity: version
        type: from_entity
        not_intent: cancel_op
        conditions:
          - active_loop: submit_issue_form
            requested_slot: version
  issue_id:
    type: text
    influence_conversation: true
    mappings:
      - entity: issue_id
        type: from_entity

  issue_label:
    type: text
    influence_conversation: true
    mappings:
      - entity: issue_label
        not_intent: cancel_op
        type: from_entity
        conditions:
          - active_loop: submit_issue_form
            requested_slot: issue_label
forms:
  submit_issue_form:
    required_slots:
        - gh_username
        - issue_description
        - version
        - issue_label
session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true
